<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WebSocket Chat Tester</title>
</head>
<body>
  <h1>WebSocket Chat Tester</h1>

  <label>User ID (uid): <input type="text" id="uid" value="123e4567-e89b-12d3-a456-426614174000"></label>
  <button onclick="connect()">Подключиться</button>
  <button onclick="disconnect()">Отключиться</button>
  <br><br>

  <label>Active Chat ID: <input type="text" id="chatId" /></label>
  <button onclick="setActiveChat()">Set Active Chat</button>
  <br><br>

  <label>Message: <input type="text" id="messageText" /></label>
  <label>Recipient ID: <input type="text" id="recipientId" /></label>
  <button onclick="sendMessage()">Send Message</button>
  <br><br>

  <pre id="log" style="background: #eee; padding: 10px; height: 300px; overflow: auto;"></pre>

    <script>
    let socket;

    function log(msg) {
      const logElem = document.getElementById("log");
      logElem.textContent += msg + "\n";
      logElem.scrollTop = logElem.scrollHeight;
    }

    function connect() {
      const uid = document.getElementById("uid").value;
      if (!uid) {
        log("Введите UID перед подключением");
        return;
      }

      socket = new WebSocket("ws://localhost:8081/chat?uid=" + uid);

      socket.onopen = () => log("WebSocket connection opened");
      socket.onmessage = (event) => log("Received: " + event.data);
      socket.onclose = () => log("WebSocket connection closed");
      socket.onerror = (error) => log("Error: " + JSON.stringify(error));
    }

    function disconnect() {
      if (socket) {
        socket.close();
        socket = null;
        log("WebSocket manually disconnected");
      }
    }

    function setActiveChat() {
      const uid = document.getElementById("uid").value;
      const chatId = parseInt(document.getElementById("chatId").value, 10);

      if (!uid || !chatId) {
        log("Введите UID и ChatID");
        return;
      }

      const event = {
        eventType: "set_active_chat",
        data: {
          uid: uid,
          chat_id: chatId
        }
      };

      socket.send(JSON.stringify(event));
      log("Sent set_active_chat: " + JSON.stringify(event));
    }

    function sendMessage() {
      const uid = document.getElementById("uid").value;
      const messageText = document.getElementById("messageText").value;
      const recipientId = document.getElementById("recipientId").value;
      const chatId = parseInt(document.getElementById("chatId").value, 10);

      if (!uid || !messageText || !recipientId || !chatId) {
        log("Введите все поля для отправки сообщения");
        return;
      }

      const event = {
        eventType: "send_message",
        data: {
          sender_id: uid,
          recipient_id: recipientId,
          chat_id: chatId,
          content: messageText
        }
      };

      socket.send(JSON.stringify(event));
      log("Sent send_message: " + JSON.stringify(event));
    }
    </script>

</body>
</html>
